iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
removeComma= function(s) {gsub(",", "", s, fixed = TRUE)}
iexwc = lapply(iex, 2, removeComma)
iexwc = sapply(iex, 2, removeComma)
?apply
?sapply
?lapply
iex <- rbind( IM, IA)
removeComma= function(s) {gsub(",", "", s, fixed = TRUE)}
iexwc = lapply(iex,  removeComma)
str(iex)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
str(HM)
str(iex)
i <- sapply(iex, is.character)
iex[i] <- lapply(iex[i], as.numeric)
str(iex)
tail(iex)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
removeComma= function(s) {gsub(",", "", s, fixed = TRUE)}
iexwc = lapply(iex,  removeComma)
# Switch colums from character to numeric (it works because detects integer as numeric)
i <- sapply(iexwc, is.numeric)
iex[i] <- lapply(iexwc[i], as.numeric)
str(iexwc)
iex <- rbind( IM, IA)
View(iex)
tail(iex)
removeComma= function(s) {gsub(",", "", s, fixed = TRUE)}
iexwc = lapply(iex,  removeComma)
tail(iexwc)
tail(iexwc)
str(iexwc)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iexwc)
iex$Date <- as.Date(iexwc$Date, format ="%d-%b-%y")
str(iexwc)
iex <- rbind( IM, IA)
str(iex)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
View(iex)
tail(iex)
removeComma= function(s) {gsub(",", "", s, fixed = TRUE)}
iexwc = lapply(iex,  removeComma)
str(iexwc)
str(iex)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
removeComma= function(s) {gsub(",", "", s, fixed = TRUE)}
iexwc = lapply(iex$Exports,  removeComma)
str(iexwc)
?gsub
?lapply
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
removeComma= function(s) {gsub(",", "", s, fixed = TRUE)}
iexwc = sapply(iex$Exports,  removeComma)
str(iexwc)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
removeComma= function(s) {gsub(",", "", s, fixed = TRUE)}
iexwc = lapply(iex$Exports,  removeComma)
str(iexwc)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
removeComma= function(s) {gsub(",", "", s, fixed = TRUE)}
iexwc = lapply(iex$Exports,  removeComma, simplify=F)
str(iexwc)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
removeComma= function(s) {gsub(",", "", s, fixed = TRUE)}
lapply(iex$Exports,  removeComma, simplify=F)
lapply(iex$Exports,  removeComma)
str(iex)
removeComma= function(s) {gsub(",", "", s, fixed = TRUE)}
zz <- lapply(iex$Exports,  removeComma)
str(iex)
tail(iex)
tail(zz)
lapply(iex$Exports,  removeComma)
str(iex)
tail(iex)
zz <- lapply(iex,  removeComma)
str(iex)
tail(iex)
str(zz)
tail(zz)
str(zz)
zz$Date <- as.Date(zz$Date, format ="%d-%b-%y")
str(zz)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
removeComma= function(s) {gsub(",", "", s)}
zz <- lapply(iex,  removeComma)
str(iex)
str(zz)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
removeComma= function(s) {gsub(",", "", s)}
zz <- lapply(iex$Exports,  removeComma)
str(zz)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
removeComma= function(s) {gsub(",", "", s)}
zz <- apply(iex$Exports,  removeComma)
str(zz)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
removeComma= function(s) {gsub(",", "", s)}
zz <- apply(iex$Exports,  removeComma, FIXED=T, StringasAsFactors = F)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
removeComma= function(s) {gsub(",", "", s)}
zz <- apply(iex$Exports,  removeComma, FIXED=T,stringsAsFactors = FALSE)
zz <- lapply(iex$Exports,  removeComma, FIXED=T,stringsAsFactors = FALSE)
zz <- lapply(iex$Exports,  removeComma, fiexd=T,stringsAsFactors = FALSE)
zz <- lapply(iex$Exports,  removeComma, fixed=T,stringsAsFactors = FALSE)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
removeComma= function(s) {gsub(",", "", s,fixed = TRUE)}
# sWithoutCommas = gsub(",", "", s, fixed = TRUE)
zz <- lapply(iex$Exports,  removeComma, stringsAsFactors = FALSE)
removeComma= function(s) {gsub(",", "", s,fixed = TRUE, stringsAsFactors = FALSE)}
zz <- lapply(iex$Exports,  removeComma)
zz <- lapply(iex,  removeComma)
removeComma= function(s) {gsub(",", "", s,fixed = TRUE)}
# sWithoutCommas = gsub(",", "", s, fixed = TRUE)
zz <- lapply(iex,  removeComma)
str(iex)
str(zz)
zz$Date <- as.Date(zz$Date, format ="%d-%b-%y")
str(zz)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
zz <- apply(apply(iex, 2, gsub, patt=",", replace=""), 2, as.numeric)
str(zz)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
zz <- apply(apply(iex$Exports, 2, gsub, patt=",", replace=""), 2, as.numeric)
zz <- apply(iex$Exports, 2, gsub, patt=",", replace="")
zz <- lapply(iex$Exports, 2, gsub, patt=",", replace="")
zz <- lapply(iex$Exports, gsub, patt=",", replace="")
str(zz)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
zz <- lapply(iex, gsub, patt=",", replace="")
tail(zz)
str(zz)
str(iex)
zz <- lapply(iex[,3:4], gsub, patt=",", replace="")
str(zz)
xx <- iex[,3:4]
head(xx)
tail(xx)
zz <- lapply(xx], gsub, patt=",", replace="")
zz <- lapply(xx, gsub, patt=",", replace="")
head(zz)
x1 <- iex[,3]
x2 <- iex[,4]
head(x1)
x1 <- iex[,3]
x2 <- iex[,4]
head(x1)
tail(x2)
z1 <- lapply(x1, gsub, patt=",", replace="")
z2  <- lapply(x2, gsub, patt=",", replace="")
head(z1)
tail(22)
z1 <- apply(x1, gsub, patt=",", replace="")
z2  <- apply(x2, gsub, patt=",", replace="")
z1 <- apply(x1,2, gsub, patt=",", replace="")
head(x1)
tail(x2)
z1 <- sapply(x1, gsub, patt=",", replace="")
z2  <- sapply(x2, gsub, patt=",", replace="")
head(z1)
tail(z2)
z1 <- vapply(x1, gsub, patt=",", replace="")
z1 <- apply(x1, gsub, patt=",", replace="")
?apply
z1 <- apply(x1,1, gsub, patt=",", replace="")
z1 <- apply(x1,2, gsub, patt=",", replace="")
?read.table
?read.csv
z2  <- sapply(x2,1, gsub, patt=",", replace="")
tail(z2)
head(z2)
str(z2)
z1 <- apply(x1,2, gsub, patt=",", replace="")
z1 <- apply(x1, gsub, patt=",", replace="")
head(x1)
tail(x1)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
x1 <- iex[,3]
x2 <- iex[,4]
head(x1)
tail(x1)
head(x2)
tail(x2)
z2  <- apply(x2,1, gsub, patt=",", replace="")
z2  <- apply(x2,2, gsub, patt=",", replace="")
str(z2)
z2  <- sapply(x2,2, gsub, patt=",", replace="")
z2  <- sapply(x2, gsub, patt=",", replace="")
str(z2)
tail(z2)
z2  <- apply(sapply(x2, gsub, patt=",", replace=""), 2, as.numeric)
z2  <- apply(sapply(x2, gsub, patt=",", replace=""), 1, as.numeric)
z2  <- sapply(sapply(x2, gsub, patt=",", replace=""), 1, as.numeric)
z2  <- sapply(sapply(x2, gsub, patt=",", replace=""), as.numeric)
str(z2)
tail(z2)
unname(z2)
z2 <- unname(z2)
tail(z2)
?cbind
x1 <- iex[,3]
x2 <- iex[,4]
z1 <- sapply(apply(x1, gsub, patt=",", replace=""), as.numeric)
z2  <- sapply(sapply(x2, gsub, patt=",", replace=""), as.numeric)
z1 <- sapply(sapply(x1, gsub, patt=",", replace=""), as.numeric)
str(z2)
tail(z2)
z2  <- sapply(sapply(x2, gsub, patt=",", replace=""), as.numeric)
str(z2)
z2 <- unname(z2)
head(z1)
tail(z2)
head(x1)
tail(x1)
head(x2)
tail(x2)
z1 <- unname(sapply(sapply(x1, gsub, patt=",", replace=""), as.numeric))
z2  <- unname(sapply(sapply(x2, gsub, patt=",", replace=""), as.numeric))
str(z2)
head(z1)
tail(z2)
yy <- cbind(iex,z1)
str(yy)
yy <- cbind(iex,Exports1=z1)
View(yy)
tail(yy)
yy <- cbind(iex,Imports1=z1, Exports2=z2)
View(yy)
View(yy)
tail(yy)
str(yy)
keeps <- C(Date, Hour, Imports1, Exports2)
keeps <- C("Date", "Hour", "Imports1", "Exports2")
myCols <- C("Date", "Hour", "Imports1", "Exports2")
myCols <- c("Date", "Hour", "Imports1", "Exports2")
zz <- yy[myCols]
str(zz)
rename(zz, c("Imports1"="Imports", "Exports2"="Exports"))
require(plyr)
rename(zz, c("Imports1"="Imports", "Exports2"="Exports"))
mm <- rename(zz, c("Imports1"="Imports", "Exports2"="Exports"))
View(mm)
rm (mm)
zz <- rename(zz, c("Imports1"="Imports", "Exports2"="Exports"))
View(zz)
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
x1 <- iex[,3] # Imports
x2 <- iex[,4] # Exports
# Clue on removing commas came from here:
# https://stat.ethz.ch/pipermail/r-help/2008-January/152350.html
z1 <- unname(sapply(sapply(x1, gsub, patt=",", replace=""), as.numeric))
z2  <- unname(sapply(sapply(x2, gsub, patt=",", replace=""), as.numeric))
yy <- cbind(iex,Imports1=z1, Exports1=z2)
str(yy)
myCols <- c("Date", "Hour", "Imports1", "Exports2")
str(yy)
myCols <- c("Date", "Hour", "Imports1", "Exports2")
iex <- yy[myCols]
str(yy)
str(yy)
myCols <- c("Date", "Hour", "Imports1", "Exports2")
iex <- yy[myCols]
iex <- yy[,myCols]
yy <- yy[myCols]
str(yy)
iex <- yy[,myCols]
myCols
iex <- yy[myCols]
myCols <- c("Date","Hour","Imports1","Exports2")
myCols
iex <- yy[myCols]
zz <- yy[myCols]
str(yy)
myCols <- c("Date","Hour","Imports1","Exports2")
myCols
zz <- yy[myCols]
yy <- cbind(iex,Imports1=z1, Exports1=z2)
View(yy)
View(yy)
str(yy)
myCols <- c("Date","Hour","Imports1","Exports2")
myCols
zz <- yy[myCols]
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
x1 <- iex[,3] # Imports
x2 <- iex[,4] # Exports
# Clue on removing commas came from here:
# https://stat.ethz.ch/pipermail/r-help/2008-January/152350.html
z1 <- unname(sapply(sapply(x1, gsub, patt=",", replace=""), as.numeric))
z2  <- unname(sapply(sapply(x2, gsub, patt=",", replace=""), as.numeric))
yy <- cbind(iex,Imports1=z1, Exports1=z2)
str(yy)
myCols <- c("Date","Hour","Imports1","Exports2")
myCols
zz <- yy[myCols]
zz <- yy[,myCols]
zz <- yy[myCols,]
str(zz)
zz <- yy[myCols]
zz <- yy["Date","Hour","Imports1","Exports2"]
myCols <- c("Date","Hour","Imports1","Exports1")
zz <- yy[myCOls]
str(yy)
myCols <- c("Date","Hour","Imports1","Exports1")
myCols
zz <- yy[myCOls]
zz <- yy[myCols]
str(zz)
iex <- rename(iex, c("Imports1"="Imports", "Exports2"="Exports"))
iex <- yy[myCols]
str(zz)
iex <- rename(iex, c("Imports1"="Imports", "Exports2"="Exports"))
iex <- rename(iex, c("Imports1"="Imports", "Exports1"="Exports"))
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
x1 <- iex[,3] # Imports
x2 <- iex[,4] # Exports
# Clue on removing commas came from here:
# https://stat.ethz.ch/pipermail/r-help/2008-January/152350.html
z1 <- unname(sapply(sapply(x1, gsub, patt=",", replace=""), as.numeric))
z2  <- unname(sapply(sapply(x2, gsub, patt=",", replace=""), as.numeric))
yy <- cbind(iex,Imports1=z1, Exports1=z2)
str(yy)
myCols <- c("Date","Hour","Imports1","Exports1")
myCols
iex <- yy[myCols]
str(zz)
iex <- rename(iex, c("Imports1"="Imports", "Exports1"="Exports"))
str(iex)
rm(IA,IA,yy,z1,z2)
rm(x1,x2,z1,z2)
rm(IA,IA,yy)
HOEP_Master <- "http://ieso.ca/imoweb/pubs/marketReports/download/HOEP-20150102.csv"
hoep <- read.table(textConnection(getURL(HOEP_Master)) , header=T, sep=",", stringsAsFactors = FALSE)
str(hoep)# Date = chr hour = int, hoep=num
hoep$Date <- as.Date(hoep$Date, format ="%d-%b-%y")#"%m/%d/%Y")
i <- sapply(hoep, is.numeric)
hoep[i] <- lapply(hoep[i], as.numeric)
str(hoep)
WIND_Master <- "http://ieso.ca/imoweb/pubs/marketReports/download/HourlyWindFarmGen_20150102.csv"
WM <- read.table(textConnection(getURL(WIND_Master)) , header=T, sep=",", stringsAsFactors = FALSE)
str(WM) # date is chr -- rest is int. Must set NA's to Zero
WM[is.na(WM)] <- 0
str(WM) # date is chr -- rest is int. Must set NA's to Zero
WM <- read.table(textConnection(getURL(WIND_Master)) , header=T, sep=",", stringsAsFactors = FALSE)
str(WM) # date is chr -- rest is int. Must set NA's to Zero
WM$Date <- as.Date(WM$Date, format ="%d-%b-%y")
str(WM)
WM[is.na(WM)] <- 0
i <- sapply(WM, is.numeric)
WM[i] <- lapply(WM[i], as.numeric)
str(WM) # date is chr -- rest is int. Must set NA's to Zero
install.packages(c("httr", "lazyeval", "manipulate"))
?httr
??httr
??manipulate
myDrive <- "J:"
myDir <- "/Ont-Power"
myPwd <- paste(myDrive, myDir, sep="")
myPwd
setwd(myPwd)
getwd()
source("Main.R")
require("RCurl")
require(plyr)
require(lubridate)
#read.table(textConnection(getURL("http://.../data.csv",
#                                 userpwd = "user:pass")),
#sep=",", header=TRUE)
# hoep <- read.csv("J:/environment/Imports/HOEP/HOEP-20141231A.csv" , header=T, sep=",", stringsAsFactors = FALSE
# Starting Page
#http://www.ieso.ca/Pages/Power-Data/default.aspx#supply
# Demand # Master + add-on
# http://www.ieso.ca/Pages/Power-Data/Demand.aspx
# http://ieso.ca/imoweb/pubs/marketReports/download/HourlyDemands_2002-2013.csv
# Demand all
print("Demand Files")
DEMAND_Master <- "http://ieso.ca/imoweb/pubs/marketReports/download/HourlyDemands_2002-2013.csv"
DEMAND_Add <- "http://ieso.ca/imoweb/pubs/marketReports/download/HourlyDemands-20150102.csv"
DM <- read.table(textConnection(getURL(DEMAND_Master)) , header=T, sep=",", stringsAsFactors = FALSE)
DA <- read.table(textConnection(getURL(DEMAND_Add)) , header=T, sep=",", stringsAsFactors = FALSE)
#str(DM) # Date = chr rest is int
#str(DA) # as above
hrd <- rbind( DM, DA)
#class(hrdemand$Date)=="Date"
#str(hrd)
hrd$Date <- as.Date(hrd$Date, format ="%d-%b-%y")
str(hrd)
# Switch colums from integer to numeric (it works because detects integer as numeric)
i <- sapply(hrd, is.numeric)
hrd[i] <- lapply(hrd[i], as.numeric)
#good <- complete.cases(hrdemand)
#sum(good) # is sum same as number of rows in hwf??
str(hrd)
# Demand working 1/3/2015 11:12AM
rm(DM,DA) # Get rid of uneeded tables
rm(DEMAND_Master, DEMAND_Add)
print("HOEP FIles")
#HOEP
# http://www.ieso.ca/Pages/Power-Data/price.aspx
HOEP_Master <- "http://ieso.ca/imoweb/pubs/marketReports/download/HOEP-20150102.csv"
hoep <- read.table(textConnection(getURL(HOEP_Master)) , header=T, sep=",", stringsAsFactors = FALSE)
str(hoep)# Date = chr hour = int, hoep=num
hoep$Date <- as.Date(hoep$Date, format ="%d-%b-%y")#"%m/%d/%Y")
i <- sapply(hoep, is.numeric)
hoep[i] <- lapply(hoep[i], as.numeric)
# str(hoep)
# http://www.ieso.ca/Pages/Power-Data/price.aspx
# Imp/Exp base + addon
print("Import Export Files")
# http://www.ieso.ca/Pages/Power-Data/Supply.aspx
IMPEXP_Master <- "http://ieso.ca/imoweb/pubs/marketReports/download/HourlyImportExportSchedules_2002-2013.csv"
IMPEXP_Add <- "http://ieso.ca/imoweb/pubs/marketReports/download/HourlyImportExportSchedules-20150102.csv"
IM <- read.table(textConnection(getURL(IMPEXP_Master)) , header=T, sep=",", stringsAsFactors = FALSE)
IA <- read.table(textConnection(getURL(IMPEXP_Add)) , header=T, sep=",", stringsAsFactors = FALSE)
# COmbine tables and format Date correctly
iex <- rbind( IM, IA)
iex$Date <- as.Date(iex$Date, format ="%d-%b-%y")
str(iex)
#Create vecttors of Import and Export -- must clean commas
x1 <- iex[,3] # Imports
x2 <- iex[,4] # Exports
# Clue on removing commas came from here:
# https://stat.ethz.ch/pipermail/r-help/2008-January/152350.html
# Create new vectors with cleaned data
z1 <- unname(sapply(sapply(x1, gsub, patt=",", replace=""), as.numeric))
z2  <- unname(sapply(sapply(x2, gsub, patt=",", replace=""), as.numeric))
# Bind Vectors to a dat frame with old conntents as well
yy <- cbind(iex,Imports1=z1, Exports1=z2)
# Keep only the "good" columns
myCols <- c("Date","Hour","Imports1","Exports1")
myCols
iex <- yy[myCols]
# Rename colums using PLYR -- see require(plyr) above
iex <- rename(iex, c("Imports1"="Imports", "Exports1"="Exports"))
#rm(IMPEXP_Master, IMPEXP_Add)
rm(x1,x2,z1,z2)
rm(IM,IA,yy)
print("Wind File")
# Wind Gen -- all
# http://www.ieso.ca/Pages/Power-Data/Supply.aspx
WIND_Master <- "http://ieso.ca/imoweb/pubs/marketReports/download/HourlyWindFarmGen_20150102.csv"
wind <- read.table(textConnection(getURL(WIND_Master)) , header=T, sep=",", stringsAsFactors = FALSE)
str(wind) # date is chr -- rest is int. Must set NA's to Zero
wind$Date <- as.Date(wind$Date, format ="%d-%b-%y")
str(wind)
# Set NA vlaues to Zero
wind[is.na(wind)] <- 0
i <- sapply(wind, is.numeric)
wind[i] <- lapply(wind[i], as.numeric)
wind <- rename(wind, c("Total.Wind..MWh."="TotWindMWh"))
print ("Done Getting files...")
print("Combining Files")
# Mergefiles
total1 <- merge(hrd,hoep, by=c("Date","Hour"), stringsAsFactors = FALSE)
total <- merge(total1,iex, by=c("Date","Hour"), stringsAsFactors = FALSE)
#names(total)<-c("TotWindMWh")
totalf <- total[total$Date < "2006-03-01",]
totalf$TotWindMWh   <- 0
str(totalf)
www <- wind[1:3]
final1 <- merge(total,www, by=c("Date","Hour"), stringsAsFactors = FALSE)
final <- rbind(totalf,final1)
finala <- cbind(final, ym = (year(final$Date) + (month(final$Date)-1 )/ 12 ), yw = (year(final$Date) + (week(final$Date)-1)/52 ) , year = year(final$Date), month = format(month(final$Date),digits=2),  day = day(final$Date), week = week(final$Date))
final <- finala
write.table(final, file = "Data/"+"final.csv", sep = ",", col.names=T, row.names=F)
write.table(final, file = "Data/final.csv", sep = ",", col.names=T, row.names=F)
write.table(wind, file = "Data/wind.csv", sep = ",", col.names=T, row.names=F)
